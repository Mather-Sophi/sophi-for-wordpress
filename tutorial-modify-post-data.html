<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tutorial: Modify Post Data - Sophi Plugin Developer Documentation</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">

	<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono|IBM+Plex+Sans:300,400|Playfair+Display:900&display=swap" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="styles-10up.css">
</head>

<body>

<div id="main">

	
    <h1 class="page-title">Tutorial: Modify Post Data</h1>
	

    <section>

<header>
    

    <h2>Modify Post Data</h2>
</header>

<article>
    <p>When a supported post item is saved (whether a publish, update, delete or unpublish event), data about that item is synced over to the Sophi service. While the intention of this plugin is to accurately capture all the necessary information automatically, there are some use cases that will need to modify this data prior to it being synced.</p>
<p>The data about each supported post item is passed through a custom filter (<a href="sophi_post_data.html"><code>sophi_post_data</code></a>), which allows you to customize this information. See below for a few examples of how to utilize this filter.</p>
<p>A few things to note:</p>
<ol>
<li>Where you add this code will depend on your individual setup. If you are using a custom theme, you can add these to your main <code>functions.php</code> file. If you're using a public theme, you might want to create a custom plugin to hold these code changes, so you don't lose those changes when you update your theme</li>
<li>If data is changed or added, you may need to coordinate with the Sophi.io team to ensure content is appropriately received</li>
<li>Data that is changed needs to stay the same type as it is currently. For instance, if something is currently an array, it should stay an array</li>
</ol>
<h3 id="replace-existing-data">Replace existing data</h3>
<p>One of the fields that is sent is called <code>byline</code>. This is currently set to the author display name. If you need to change this to something else, like the author's nickname, you can do the following:</p>
<pre class="prettyprint source lang-php"><code>/**
 * Change the post data we send to Sophi.
 *
 * Update the byline value to use the author's nickname.
 *
 * @param array $post_data Formatted post data.
 * @return array
 */
function custom_prefix_sophi_post_data( $post_data = [] ) {
	// Ensure we have a proper post object.
	$post = get_post( (int) $post_data['contentId'] );
	if ( ! $post || ! is_a( $post, 'WP_Post' ) ) {
		return $post_data;
	}

	// This field needs to be an array, even though it only has one value.
	$post_data['byline'] = [ get_the_author_meta( 'nickname', $post->post_author ) ];

	return $post_data;
}
add_filter( 'sophi_post_data', 'custom_prefix_sophi_post_data' );
</code></pre>
<p>Another field that is sent is called <code>isSponsored</code>. This is currently hardcoded to <code>false</code>. If you need to change this to <code>true</code>, you can do the following:</p>
<pre class="prettyprint source lang-php"><code>/**
 * Change the post data we send to Sophi.
 *
 * Update the isSponsored value to true.
 *
 * @param array $post_data Formatted post data.
 * @return array
 */
function custom_prefix_sophi_post_data( $post_data = [] ) {
	// Ensure we have a proper post object.
	$post = get_post( (int) $post_data['contentId'] );
	if ( ! $post || ! is_a( $post, 'WP_Post' ) ) {
		return $post_data;
	}

	$post_data['isSponsored'] = true;

	return $post_data;
}
add_filter( 'sophi_post_data', 'custom_prefix_sophi_post_data' );
</code></pre>
<h3 id="modify-existing-data">Modify existing data</h3>
<p>One of the fields that is sent is called <code>allSections</code>. This is currently set to an array of category paths. If you want to add additional taxonomy paths to this value, you can do the following:</p>
<pre class="prettyprint source lang-php"><code>/**
 * Change the post data we send to Sophi.
 *
 * Add more paths to the allSections value.
 *
 * @param array $post_data Formatted post data.
 * @return array
 */
function custom_prefix_sophi_post_data( $post_data = [] ) {
	// Ensure we have a proper post object.
	$post = get_post( (int) $post_data['contentId'] );
	if ( ! $post || ! is_a( $post, 'WP_Post' ) ) {
		return $post_data;
	}

	$current_sections = $post_data['allSections'];

	// This custom function is not provided here but this would be similar to the
	// SophiWP\Utils\get_post_categories_paths utility function
	$new_sections = custom_prefix_get_taxonomy_paths( $post->ID, 'custom_taxonomy_slug' );

	// Add our new sections to the end of our existing sections.
	$post_data['allSections'] = array_merge( $current_sections, $new_sections );

	return $post_data;
}
add_filter( 'sophi_post_data', 'custom_prefix_sophi_post_data' );
</code></pre>
<h3 id="add-new-data">Add new data</h3>
<p>If you need to add an entirely new field, that can be done as well:</p>
<pre class="prettyprint source lang-php"><code>/**
 * Change the post data we send to Sophi.
 *
 * Add a new field called videoIds.
 *
 * @param array $post_data Formatted post data.
 * @return array
 */
function custom_prefix_sophi_post_data( $post_data = [] ) {
	// Ensure we have a proper post object.
	$post = get_post( (int) $post_data['contentId'] );
	if ( ! $post || ! is_a( $post, 'WP_Post' ) ) {
		return $post_data;
	}

	// This custom function is not provided here but this would
	// run some logic to get video IDs from the post object.
	$post_data['videoIds'] = custom_prefix_get_video_ids( $post->ID );

	return $post_data;
}
add_filter( 'sophi_post_data', 'custom_prefix_sophi_post_data' );
</code></pre>
</article>

</section>


    <footer>
		<a href="https://sophi.io/">Sophi.io</a> &bull;
		<a href="https://github.com/globeandmail/sophi-for-wordpress/">Sophi for WordPress on GitHub</a> &bull;
    <a href="https://wordpress.org/plugins/sophi/">Sophi on WordPress.org</a> &bull;
		<a href="https://www.sophi.io/careers/">Careers at Sophi</a>
	</footer>


</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Actions</h3><ul><li><a href="sophi_cms_tracking_result.html">sophi_cms_tracking_result</a></li><li><a href="sophi_init.html">sophi_init</a></li><li><a href="sophi_loaded.html">sophi_loaded</a></li></ul><h3>Filters</h3><ul><li><a href="sophi_amp_tracking_data.html">sophi_amp_tracking_data</a></li><li><a href="sophi_available.html">sophi_available</a></li><li><a href="sophi_bypass_curated_posts_cache.html">sophi_bypass_curated_posts_cache</a></li><li><a href="sophi_bypass_get_cache.html">sophi_bypass_get_cache</a></li><li><a href="sophi_cache_duration.html">sophi_cache_duration</a></li><li><a href="sophi_cli_per_page_limit.html">sophi_cli_per_page_limit</a></li><li><a href="sophi_cms_tracking_request_data.html">sophi_cms_tracking_request_data</a></li><li><a href="sophi_curated_post_list.html">sophi_curated_post_list</a></li><li><a href="sophi_hierarchial_taxonomy_for_breadcrumb.html">sophi_hierarchial_taxonomy_for_breadcrumb</a></li><li><a href="sophi_non_hierarchial_taxonomy_for_breadcrumb.html">sophi_non_hierarchial_taxonomy_for_breadcrumb</a></li><li><a href="sophi_page_need_tracking.html">sophi_page_need_tracking</a></li><li><a href="sophi_post_content_type.html">sophi_post_content_type</a></li><li><a href="sophi_post_data.html">sophi_post_data</a></li><li><a href="sophi_request_args.html">sophi_request_args</a></li><li><a href="sophi_request_result.html">sophi_request_result</a></li><li><a href="sophi_site_automation_block_output.html">sophi_site_automation_block_output</a></li><li><a href="sophi_supported_post_types.html">sophi_supported_post_types</a></li><li><a href="sophi_tracker_emitter_debug.html">sophi_tracker_emitter_debug</a></li><li><a href="sophi_tracking_data.html">sophi_tracking_data</a></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-change-supported-post-types.html">Change Supported Post Types</a></li><li><a href="tutorial-modify-post-data.html">Modify Post Data</a></li></ul>
</nav>

<br class="clear">

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>